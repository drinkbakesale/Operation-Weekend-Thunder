<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPERATION: WEEKEND THUNDER</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Bebas+Neue&family=Anton&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    min-height: 100vh;
    color: #fff;
    font-family: 'Russo One', sans-serif;
    overflow-x: hidden;
    background: #1a0800;
  }

  /* Sunset / fire sky background */
  .bg-sky {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(
      180deg,
      #0d0d2b 0%,
      #1a0a2e 10%,
      #4a1942 25%,
      #b5173b 45%,
      #e85d04 60%,
      #ff9e00 75%,
      #ffba08 85%,
      #1a0800 95%
    );
    z-index: 0;
  }

  /* Silhouette treeline/city */
  .bg-silhouette {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 120px;
    background: #0a0400;
    z-index: 0;
    clip-path: polygon(
      0% 100%, 0% 60%, 3% 55%, 5% 70%, 8% 40%, 10% 45%, 12% 20%, 14% 25%,
      16% 50%, 20% 45%, 22% 30%, 25% 35%, 28% 55%, 32% 50%, 35% 25%,
      37% 30%, 40% 60%, 45% 55%, 48% 35%, 50% 40%, 52% 20%, 54% 25%,
      56% 45%, 60% 40%, 63% 55%, 66% 50%, 70% 30%, 73% 35%, 76% 60%,
      80% 55%, 83% 40%, 86% 45%, 88% 25%, 90% 30%, 92% 50%, 95% 45%,
      97% 55%, 100% 50%, 100% 100%
    );
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
  }

  /* TITLE - big bold action movie poster */
  .title-block {
    text-align: center;
    padding: 30px 0 10px;
  }

  .subtitle {
    font-family: 'Russo One', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 8px;
    color: #ffba08;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  h1 {
    font-family: 'Anton', sans-serif;
    font-size: clamp(2.8rem, 10vw, 5rem);
    font-weight: 400;
    text-transform: uppercase;
    line-height: 0.95;
    color: #fff;
    text-shadow:
      0 0 10px rgba(255,150,0,0.8),
      0 0 40px rgba(255,80,0,0.5),
      0 4px 0 #b5173b,
      0 8px 0 #8b1030;
    letter-spacing: 4px;
  }

  .tagline {
    font-family: 'Russo One', sans-serif;
    font-size: 0.7rem;
    color: #ffba08;
    letter-spacing: 3px;
    margin-top: 10px;
    text-transform: uppercase;
  }

  /* Metallic chrome divider */
  .chrome-divider {
    height: 4px;
    margin: 25px 0;
    background: linear-gradient(90deg,
      transparent,
      #8b6914 10%, #ffd700 20%, #fff 30%, #ffd700 40%, #8b6914 50%,
      #ffd700 60%, #fff 70%, #ffd700 80%, #8b6914 90%,
      transparent
    );
    border-radius: 2px;
  }

  /* FORM SECTIONS */
  .form-section {
    margin-bottom: 25px;
  }

  label, .section-label {
    display: block;
    font-family: 'Anton', sans-serif;
    font-size: 1.2rem;
    font-weight: 400;
    color: #ffba08;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 8px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .section-desc {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.7);
    margin-bottom: 12px;
    font-family: sans-serif;
  }

  /* Dropdown */
  select {
    width: 100%;
    padding: 14px 18px;
    font-family: 'Russo One', sans-serif;
    font-size: 1rem;
    color: #fff;
    background: rgba(40,10,0,0.85);
    border: 2px solid #b5173b;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23ffba08'%3E%3Cpolygon points='0,4 16,4 8,14'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  select:focus, select:hover {
    border-color: #ff9e00;
    box-shadow: 0 0 20px rgba(255,158,0,0.3);
  }

  select option {
    background: #2a0a00;
    color: #fff;
  }

  /* Checkbox grid */
  .weekend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  @media (max-width: 500px) {
    .weekend-grid { grid-template-columns: 1fr; }
  }

  .weekend-option {
    position: relative;
    overflow: visible;
  }

  .weekend-option input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .weekend-option label.weekend-label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    background: rgba(40,10,0,0.7);
    border: 2px solid rgba(181,23,59,0.4);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Russo One', sans-serif;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.8);
    letter-spacing: 0;
    text-transform: none;
    text-shadow: none;
    position: relative;
    overflow: hidden;
  }

  .weekend-option label.weekend-label::before {
    content: '';
    width: 20px;
    height: 20px;
    border: 2px solid #b5173b;
    border-radius: 3px;
    flex-shrink: 0;
    transition: all 0.2s;
  }

  /* Preferred (top 3) - gold/fire accent */
  .preferred .weekend-option input:checked + label.weekend-label {
    border-color: #ff9e00;
    background: rgba(255,158,0,0.2);
    color: #fff;
    box-shadow: 0 0 15px rgba(255,158,0,0.3), 0 0 30px rgba(255,93,4,0.15);
  }

  .preferred .weekend-option input:checked + label.weekend-label::before {
    background: #ff9e00;
    border-color: #ffba08;
    box-shadow: 0 0 8px rgba(255,186,8,0.6);
  }

  /* Blocked - red accent */
  .blocked .weekend-option input:checked + label.weekend-label {
    border-color: #cc0000;
    background: rgba(200,0,0,0.2);
    color: #ff4444;
    box-shadow: 0 0 15px rgba(200,0,0,0.3);
  }

  .blocked .weekend-option input:checked + label.weekend-label::before {
    background: #cc0000;
    border-color: #ff0000;
    box-shadow: 0 0 8px rgba(255,0,0,0.5);
  }

  .weekend-option label.weekend-label:hover {
    border-color: #b5173b;
    background: rgba(181,23,59,0.2);
  }

  /* EXPLOSION EFFECT (canvas overlay per checkbox) */
  .explosion-canvas {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 10;
  }

  /* Screen shake */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10% { transform: translateX(-4px) translateY(2px); }
    20% { transform: translateX(4px) translateY(-2px); }
    30% { transform: translateX(-3px) translateY(1px); }
    40% { transform: translateX(3px); }
    50% { transform: translateX(-2px) translateY(-1px); }
    60% { transform: translateX(2px) translateY(1px); }
    70% { transform: translateX(-1px); }
    80% { transform: translateX(1px); }
  }

  .shake {
    animation: shake 0.4s ease-out;
  }

  /* Muzzle flash for dropdown */
  @keyframes muzzleFlash {
    0% { opacity: 1; transform: scale(0.5); }
    20% { opacity: 1; transform: scale(1.2); }
    100% { opacity: 0; transform: scale(2); }
  }

  .muzzle-flash {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(circle, #fff 0%, #ffba08 30%, #ff6600 60%, transparent 70%);
    pointer-events: none;
    opacity: 0;
    z-index: 20;
  }

  .muzzle-flash.fire {
    animation: muzzleFlash 0.3s ease-out forwards;
  }

  /* Error message */
  .error-msg {
    font-family: 'Russo One', sans-serif;
    font-size: 0.7rem;
    color: #ff4444;
    margin-top: 8px;
    display: none;
    text-shadow: 0 0 6px rgba(255,0,0,0.4);
  }

  .error-msg.visible { display: block; }

  /* SUBMIT BUTTON - big action style */
  .submit-wrap {
    text-align: center;
    margin: 35px 0;
  }

  button[type="submit"] {
    font-family: 'Anton', sans-serif;
    font-weight: 400;
    font-size: 1.4rem;
    letter-spacing: 6px;
    text-transform: uppercase;
    color: #fff;
    padding: 18px 55px;
    border: 3px solid #ffd700;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    background: linear-gradient(180deg, #cc0000 0%, #8b0000 50%, #5a0000 100%);
    box-shadow:
      0 4px 0 #3a0000,
      0 0 30px rgba(255,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    transition: all 0.2s;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    overflow: hidden;
  }

  button[type="submit"]::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.6s;
  }

  button[type="submit"]:hover::before { left: 150%; }

  button[type="submit"]:hover {
    box-shadow:
      0 4px 0 #3a0000,
      0 0 50px rgba(255,0,0,0.5),
      0 0 80px rgba(255,100,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.3);
    transform: translateY(-1px);
  }

  button[type="submit"]:active {
    transform: translateY(2px);
    box-shadow:
      0 1px 0 #3a0000,
      0 0 20px rgba(255,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  button[type="submit"]:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* Spinner */
  .spinner {
    display: none;
    width: 40px;
    height: 40px;
    border: 4px solid rgba(181,23,59,0.3);
    border-top: 4px solid #ffba08;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto;
  }

  .spinner.visible { display: block; }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Success screen */
  .success-screen {
    display: none;
    text-align: center;
    padding: 60px 20px;
  }

  .success-screen.visible { display: block; }

  .success-screen h2 {
    font-family: 'Anton', sans-serif;
    font-size: clamp(2rem, 7vw, 3.5rem);
    color: #fff;
    text-shadow:
      0 0 10px rgba(255,150,0,0.8),
      0 0 40px rgba(255,80,0,0.5),
      0 4px 0 #b5173b;
    text-transform: uppercase;
    letter-spacing: 4px;
    margin-bottom: 20px;
  }

  .success-screen p {
    color: rgba(255,255,255,0.8);
    font-size: 1rem;
    font-family: sans-serif;
  }

  .success-quote {
    font-family: 'Russo One', sans-serif;
    font-size: 0.75rem;
    color: #ffba08;
    margin-top: 30px;
    line-height: 1.8;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }

  /* Explosion particle layer */
  #particle-layer {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 100;
  }
</style>
</head>
<body>
<div class="bg-sky"></div>
<div class="bg-silhouette"></div>
<canvas id="particle-layer"></canvas>

<div class="container" id="main-container">
  <div class="title-block">
    <div class="subtitle">/// Classified Mission Briefing ///</div>
    <h1>Operation<br>Weekend Thunder</h1>
    <div class="tagline">Select your weekends. Save the world.</div>
  </div>

  <div class="chrome-divider"></div>

  <form id="mission-form" name="weekend-thunder" method="POST" data-netlify="true" netlify-honeypot="bot-field">
    <p style="display:none"><input name="bot-field"></p>
    <input type="hidden" name="preferred1" id="h-preferred1">
    <input type="hidden" name="preferred2" id="h-preferred2">
    <input type="hidden" name="preferred3" id="h-preferred3">
    <input type="hidden" name="blocked" id="h-blocked">

    <!-- Name -->
    <div class="form-section" style="position:relative;">
      <label for="codename">Identify Yourself, Soldier</label>
      <select id="codename" name="codename" required>
        <option value="">-- Select Your Codename --</option>
        <option value="Dutch (Predator)">Dutch (Predator)</option>
        <option value="John Matrix (Commando)">John Matrix (Commando)</option>
        <option value="John Rambo">John Rambo</option>
        <option value="Snake Plissken">Snake Plissken</option>
        <option value="Martin Riggs (Lethal Weapon)">Martin Riggs (Lethal Weapon)</option>
        <option value="John McClane (Die Hard)">John McClane (Die Hard)</option>
        <option value="Jack Burton (Big Trouble)">Jack Burton (Big Trouble)</option>
        <option value="Dalton (Road House)">Dalton (Road House)</option>
        <option value="Marion Cobretti (Cobra)">Marion Cobretti (Cobra)</option>
        <option value="Axel Foley (Beverly Hills Cop)">Axel Foley (Beverly Hills Cop)</option>
        <option value="The Terminator">The Terminator</option>
        <option value="RoboCop (Alex Murphy)">RoboCop (Alex Murphy)</option>
        <option value="Tango & Cash">Tango &amp; Cash</option>
      </select>
      <div class="muzzle-flash" id="codename-flash"></div>
    </div>

    <div class="chrome-divider"></div>

    <!-- Preferred Weekends (Top 3) -->
    <div class="form-section preferred">
      <div class="section-label">Top 3 Preferred Weekends</div>
      <div class="section-desc">Select exactly 3 weekends for the mission. Choose wisely.</div>
      <div class="weekend-grid" id="preferred-grid"></div>
      <div class="error-msg" id="preferred-error">You must select exactly 3 weekends, soldier.</div>
    </div>

    <div class="chrome-divider"></div>

    <!-- Blocked Weekends -->
    <div class="form-section blocked">
      <div class="section-label">No-Go Weekends</div>
      <div class="section-desc">Select any weekends where you absolutely CANNOT report for duty.</div>
      <div class="weekend-grid" id="blocked-grid"></div>
    </div>

    <div class="chrome-divider"></div>

    <div class="submit-wrap">
      <button type="submit" id="submit-btn">TRANSMIT INTEL</button>
      <div class="spinner" id="spinner"></div>
    </div>
  </form>

  <div class="success-screen" id="success">
    <h2>Mission Accepted</h2>
    <p>Your intel has been transmitted to HQ.</p>
    <div class="success-quote">"I'll be back."<br>- The Terminator, 1984</div>
  </div>
</div>

<script>
  // ========== PARTICLE / EXPLOSION ENGINE ==========
  const canvas = document.getElementById('particle-layer');
  const ctx = canvas.getContext('2d');
  let particles = [];
  let animating = false;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  class Particle {
    constructor(x, y, type) {
      this.x = x;
      this.y = y;
      this.type = type; // 'fire', 'spark', 'smoke', 'star'
      this.life = 1;

      if (type === 'fire') {
        this.vx = (Math.random() - 0.5) * 8;
        this.vy = (Math.random() - 0.5) * 8 - 2;
        this.size = Math.random() * 12 + 4;
        this.decay = Math.random() * 0.03 + 0.02;
        this.color = Math.random() > 0.5 ? '#ff6600' : '#ffba08';
      } else if (type === 'spark') {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 6 + 3;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.size = Math.random() * 3 + 1;
        this.decay = Math.random() * 0.02 + 0.015;
        this.color = Math.random() > 0.3 ? '#ffba08' : '#fff';
      } else if (type === 'smoke') {
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = -Math.random() * 2 - 0.5;
        this.size = Math.random() * 15 + 8;
        this.decay = Math.random() * 0.01 + 0.008;
        this.color = '#555';
      } else if (type === 'star') {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 3 + 1;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.size = Math.random() * 6 + 3;
        this.decay = Math.random() * 0.02 + 0.02;
        this.color = '#ff0000';
        this.rotation = Math.random() * Math.PI;
        this.rotSpeed = (Math.random() - 0.5) * 0.3;
      }
    }

    update() {
      this.x += this.vx;
      this.y += this.vy;
      this.life -= this.decay;
      this.vy += 0.1; // gravity
      if (this.type === 'fire') {
        this.size *= 0.97;
      }
    }

    draw() {
      ctx.globalAlpha = Math.max(0, this.life);

      if (this.type === 'star') {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        this.rotation += this.rotSpeed;
        ctx.fillStyle = this.color;
        // 4-point star
        const s = this.size;
        ctx.beginPath();
        for (let i = 0; i < 4; i++) {
          const a = (i / 4) * Math.PI * 2 - Math.PI / 2;
          const ax = Math.cos(a) * s;
          const ay = Math.sin(a) * s;
          const b = ((i + 0.5) / 4) * Math.PI * 2 - Math.PI / 2;
          const bx = Math.cos(b) * (s * 0.35);
          const by = Math.sin(b) * (s * 0.35);
          if (i === 0) ctx.moveTo(ax, ay);
          else ctx.lineTo(ax, ay);
          ctx.lineTo(bx, by);
        }
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      } else {
        ctx.fillStyle = this.color;
        if (this.type === 'smoke') {
          ctx.globalAlpha = Math.max(0, this.life * 0.3);
        }
        ctx.beginPath();
        ctx.arc(this.x, this.y, Math.max(0, this.size), 0, Math.PI * 2);
        ctx.fill();

        // Glow for fire
        if (this.type === 'fire') {
          ctx.globalAlpha = Math.max(0, this.life * 0.3);
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size * 2, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      ctx.globalAlpha = 1;
    }
  }

  function spawnExplosion(x, y, intensity) {
    const fireCount = intensity === 'big' ? 25 : 12;
    const sparkCount = intensity === 'big' ? 20 : 10;
    const smokeCount = intensity === 'big' ? 8 : 4;
    const starCount = intensity === 'big' ? 6 : 3;

    for (let i = 0; i < fireCount; i++) particles.push(new Particle(x, y, 'fire'));
    for (let i = 0; i < sparkCount; i++) particles.push(new Particle(x, y, 'spark'));
    for (let i = 0; i < smokeCount; i++) particles.push(new Particle(x, y, 'smoke'));
    for (let i = 0; i < starCount; i++) particles.push(new Particle(x, y, 'star'));

    if (!animating) {
      animating = true;
      animateParticles();
    }
  }

  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles = particles.filter(p => p.life > 0);

    for (const p of particles) {
      p.update();
      p.draw();
    }

    if (particles.length > 0) {
      requestAnimationFrame(animateParticles);
    } else {
      animating = false;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  }

  function screenShake(intensity) {
    const container = document.getElementById('main-container');
    container.classList.remove('shake');
    void container.offsetWidth; // reflow
    container.classList.add('shake');
    setTimeout(() => container.classList.remove('shake'), 400);
  }

  // ========== FORM LOGIC ==========
  const WEEKENDS = [
    { label: 'Apr 25 - 26', value: '2026-04-25' },
    { label: 'May 2 - 3',   value: '2026-05-02' },
    { label: 'May 9 - 10',  value: '2026-05-09' },
    { label: 'May 16 - 17', value: '2026-05-16' },
    { label: 'May 23 - 24', value: '2026-05-23' },
    { label: 'May 30 - 31', value: '2026-05-30' },
    { label: 'Jun 6 - 7',   value: '2026-06-06' },
  ];

  function buildGrid(containerId, prefix) {
    const grid = document.getElementById(containerId);
    WEEKENDS.forEach((w, i) => {
      const id = `${prefix}-${i}`;
      const div = document.createElement('div');
      div.className = 'weekend-option';
      div.innerHTML = `
        <input type="checkbox" id="${id}" name="${prefix}" value="${w.value}">
        <label class="weekend-label" for="${id}">${w.label}</label>
      `;
      grid.appendChild(div);
    });
  }

  buildGrid('preferred-grid', 'preferred');
  buildGrid('blocked-grid', 'blocked');

  // --- Dropdown: muzzle flash + explosion on select ---
  document.getElementById('codename').addEventListener('change', function() {
    if (!this.value) return;
    const rect = this.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top + rect.height / 2;
    spawnExplosion(x, y, 'big');
    screenShake();

    // Flash overlay
    const flash = document.getElementById('codename-flash');
    flash.style.left = (rect.width / 2 - 30) + 'px';
    flash.style.top = (rect.height / 2 - 30 + 40) + 'px';
    flash.classList.remove('fire');
    void flash.offsetWidth;
    flash.classList.add('fire');
  });

  // --- Checkbox: explosion on check ---
  function addCheckboxEffects(name, intensity) {
    document.querySelectorAll(`input[name="${name}"]`).forEach(cb => {
      cb.addEventListener('change', function() {
        if (!this.checked) return;
        const label = this.nextElementSibling;
        const rect = label.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        spawnExplosion(x, y, intensity);
        screenShake();
      });
    });
  }

  // Preferred: gold explosion
  addCheckboxEffects('preferred', 'small');

  // Blocked: bigger red explosion
  addCheckboxEffects('blocked', 'small');

  // Enforce max 3 for preferred
  document.querySelectorAll('input[name="preferred"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const checked = document.querySelectorAll('input[name="preferred"]:checked');
      if (checked.length > 3) {
        cb.checked = false;
      }
      document.getElementById('preferred-error').classList.toggle('visible', false);
    });
  });

  // Prevent selecting same weekend as both preferred and blocked
  document.querySelectorAll('input[name="preferred"]').forEach(cb => {
    cb.addEventListener('change', () => {
      if (cb.checked) {
        const blocked = document.querySelector(`input[name="blocked"][value="${cb.value}"]`);
        if (blocked) blocked.checked = false;
      }
    });
  });

  document.querySelectorAll('input[name="blocked"]').forEach(cb => {
    cb.addEventListener('change', () => {
      if (cb.checked) {
        const preferred = document.querySelector(`input[name="preferred"][value="${cb.value}"]`);
        if (preferred) preferred.checked = false;
      }
    });
  });

  // ========== SUBMIT ==========
  document.getElementById('mission-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const codename = document.getElementById('codename').value;
    const preferred = [...document.querySelectorAll('input[name="preferred"]:checked')].map(c => c.value);
    const blocked = [...document.querySelectorAll('input[name="blocked"]:checked')].map(c => c.value);

    if (!codename) { alert('Select your codename, soldier!'); return; }
    if (preferred.length !== 3) {
      document.getElementById('preferred-error').classList.add('visible');
      return;
    }

    // BIG explosion on submit
    const btn = document.getElementById('submit-btn');
    const rect = btn.getBoundingClientRect();
    for (let i = 0; i < 5; i++) {
      setTimeout(() => {
        const offX = (Math.random() - 0.5) * rect.width;
        const offY = (Math.random() - 0.5) * rect.height;
        spawnExplosion(rect.left + rect.width/2 + offX, rect.top + rect.height/2 + offY, 'big');
      }, i * 100);
    }
    screenShake();

    document.getElementById('h-preferred1').value = preferred[0];
    document.getElementById('h-preferred2').value = preferred[1];
    document.getElementById('h-preferred3').value = preferred[2];
    document.getElementById('h-blocked').value = blocked.join(', ') || 'None';

    const spinner = document.getElementById('spinner');
    btn.disabled = true;
    btn.style.display = 'none';
    spinner.classList.add('visible');

    const formData = new URLSearchParams();
    formData.append('form-name', 'weekend-thunder');
    formData.append('codename', codename);
    formData.append('preferred1', preferred[0]);
    formData.append('preferred2', preferred[1]);
    formData.append('preferred3', preferred[2]);
    formData.append('blocked', blocked.join(', ') || 'None');

    try {
      const response = await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formData.toString()
      });

      if (response.ok) {
        // Victory explosions across the screen
        setTimeout(() => {
          for (let i = 0; i < 8; i++) {
            setTimeout(() => {
              spawnExplosion(
                Math.random() * window.innerWidth,
                Math.random() * window.innerHeight * 0.7,
                'big'
              );
            }, i * 200);
          }
        }, 300);

        document.getElementById('mission-form').style.display = 'none';
        document.getElementById('success').classList.add('visible');
      } else {
        throw new Error('Server error');
      }
    } catch (err) {
      alert('Transmission failed! Try again, soldier.');
      btn.disabled = false;
      btn.style.display = '';
      spinner.classList.remove('visible');
    }
  });
</script>
</body>
</html>
